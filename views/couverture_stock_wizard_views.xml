<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_couverture_stock_wizard_form" model="ir.ui.view">
        <field name="name">couverture.stock.wizard.form</field>
        <field name="model">couverture.stock.wizards</field>
        <field name="arch" type="xml">
            <form string="Calcul Couverture Stock">
                <sheet>
                    <div class="oe_title">
                        <h1>Analyse des données de stock </h1>
                    </div>

                    <group>
                        <group string="Paramètres">
                            <field name="company_id"
                                   readonly="1"
                                   options="{'no_create': True, 'no_edit': True}"/>
                            <field name="date_start"/>
                            <field name="date_end"/>
                            <field name="marge_livraison"/>
                            <field name="couverture_cible"/>
                        </group>

                        <!-- Bloc Options caché -->
                        <group string="Options" invisible="1">
                            <field name="auto_recalcul"/>
                            <field name="update_mode" invisible="auto_recalcul == False"/>
                        </group>
                    </group>

                    <!-- Message informatif en mode automatique (caché pour l'instant)
                    <div class="alert alert-info mt16" invisible="auto_recalcul == False">
                        <i class="fa fa-info-circle"/>
                        <strong>Mode automatique activé :</strong>
                        Le calcul se lance automatiquement à chaque modification des paramètres.
                    </div>
                    -->

                    <!-- Message d'aide
                    <div class="alert alert-warning mt16" invisible="auto_recalcul == True">
                        <i class="fa fa-lightbulb-o"/>
                        <strong>Conseil :</strong>
                        Activez le "Recalcul automatique" pour que les données se mettent à jour automatiquement
                        quand vous changez de société ou de dates.
                    </div>
                    -->
                </sheet>

                <footer>
                    <button string="Lancer le calcul"
                            type="object"
                            name="action_lancer_calcul"
                            class="btn-primary"
                            invisible="auto_recalcul == True"/>

                    <button string="Voir les résultats"
                            type="object"
                            name="action_voir_resultats"
                            class="btn-primary"
                            invisible="auto_recalcul == False"/>

                    <button string="Annuler"
                            class="btn-secondary"
                            special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="action_couverture_stock_wizard" model="ir.actions.act_window">
        <field name="name">Calcul Couverture Stock</field>
        <field name="res_model">couverture.stock.wizards</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{
            'default_date_start': context.get('default_date_start'),
            'default_date_end': context.get('default_date_end'),
            'default_company_id': context.get('allowed_company_ids', [False])[0]
        }</field>
    </record>

    <menuitem id="menu_kaderim_couverture"
              name="Proposition de commande"
              parent="stock.menu_stock_procurement"
              sequence="15"
              action="action_couverture_stock_wizard"/>
</odoo>
